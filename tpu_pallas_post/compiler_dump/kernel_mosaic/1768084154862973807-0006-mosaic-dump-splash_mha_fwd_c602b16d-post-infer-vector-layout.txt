#loc = loc(unknown)
module @splash_mha_fwd_c602b16d {
  func.func @main(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg5: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg6: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg7: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg8: memref<1024x128xi32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg9: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg10: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg11: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg12: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown)) attributes {dimension_semantics = [#tpu.dimension_semantics<parallel>, #tpu.dimension_semantics<arbitrary>, #tpu.dimension_semantics<arbitrary>], iteration_bounds = array<i64: 8, 2, 2>, scalar_prefetch = 2 : i64, scratch_operands = 0 : i64, window_params = [{transform_indices = @transform_0, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_1, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_2, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_3, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_4, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_5, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_6, window_bounds = array<i64: 1024, 128>}, {transform_indices = @transform_7, window_bounds = array<i64: 1, 1024, 128>}]} {
    %cst = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} dense<1.000000e+00> : vector<1024x128xf32> loc(#loc)
    %cst_0 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} dense<-2.38197633E+38> : vector<1024x1024xf32> loc(#loc)
    %cst_1 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} dense<-2.38197633E+38> : vector<1024x128xf32> loc(#loc)
    %c1_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 1 : i32 loc(#loc)
    %cst_2 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} dense<0.000000e+00> : vector<1024x128xf32> loc(#loc)
    %cst_3 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128),-2">]} dense<0.000000e+00> : vector<1024xf32> loc(#loc)
    %cst_4 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128),-2">]} dense<0xFF800000> : vector<1024xf32> loc(#loc)
    %cst_5 = arith.constant {out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} dense<0.000000e+00> : vector<1024x1024xf32> loc(#loc)
    %c1024_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 1024 : i32 loc(#loc)
    %c0 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : index loc(#loc)
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    %0 = tpu.erase_memref_layout %arg3 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %2 = tpu.erase_memref_layout %arg5 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %3 = tpu.erase_memref_layout %arg6 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %4 = tpu.erase_memref_layout %arg7 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %5 = tpu.reinterpret_cast %arg8 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xi32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xi32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %6 = tpu.erase_memref_layout %5 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xi32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xi32, #tpu.memory_space<vmem>> loc(#loc)
    %7 = tpu.reinterpret_cast %arg9 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %8 = tpu.erase_memref_layout %7 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %9 = tpu.reinterpret_cast %arg10 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %10 = tpu.erase_memref_layout %9 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %11 = tpu.reinterpret_cast %arg11 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %12 = tpu.erase_memref_layout %11 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %13 = tpu.erase_memref_layout %arg12 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %14 = arith.cmpi eq, %arg2, %c0_i32 {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 loc(#loc187)
    scf.if %14 {
      tpu.vector_store %12[%c0, %c0], %cst_2 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc246)
      tpu.vector_store %8[%c0, %c0], %cst_1 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc247)
      tpu.vector_store %10[%c0, %c0], %cst_2 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc248)
    } {in_layout = [#tpu.vpad<"none">]} loc(#loc188)
    %15 = arith.index_cast %arg1 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc249)
    %16 = arith.index_cast %arg2 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc249)
    %17 = memref.load %1[%c0, %15, %16] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc249)
    %18 = arith.extsi %17 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i8 to i32 loc(#loc250)
    %19 = arith.cmpi sgt, %18, %c0_i32 {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 loc(#loc251)
    %20 = memref.load %0[%c0, %15, %16] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc252)
    %21 = arith.extsi %20 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i8 to i32 loc(#loc253)
    scf.if %19 {
      %23 = vector.load %8[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc254)
      %24 = vector.load %10[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc255)
      %25 = vector.load %2[%c0, %c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc256)
      %26 = vector.shape_cast %25 {in_layout = [#tpu.vpad<"16,{0,0},(8,128)">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc256)
      %27 = vector.load %3[%c0, %c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc257)
      %28 = vector.shape_cast %27 {in_layout = [#tpu.vpad<"16,{0,0},(8,128)">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc257)
      %29 = tpu.matmul %26, %28, %cst_5 {dimension_numbers = #tpu.dot_dimension_numbers<[1], [1], [0], [0], [0, 0, 1, 0], [], []>, in_layout = [#tpu.vpad<"16,{0,0},(16,128)">, #tpu.vpad<"16,{0,0},(16,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xbf16>, vector<1024x128xbf16>, vector<1024x1024xf32> -> vector<1024x1024xf32> loc(#loc258)
      %30 = arith.muli %21, %c1024_i32 {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 loc(#loc259)
      %31 = tpu.iota {dimension = 1 : i32, out_layout = [#tpu.vpad<"32,{*,0},(8,128)">]} : vector<1024x1024xi32> loc(#loc260)
      %32 = vector.broadcast %30 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{*,*},(8,128)">]} : i32 to vector<1024x1024xi32> loc(#loc261)
      %33 = arith.addi %32, %31 {in_layout = [#tpu.vpad<"32,{*,0},(8,128)">, #tpu.vpad<"32,{*,0},(8,128)">], out_layout = [#tpu.vpad<"32,{*,0},(8,128)">]} : vector<1024x1024xi32> loc(#loc261)
      %34 = vector.load %6[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xi32, #tpu.memory_space<vmem>>, vector<1024x128xi32> loc(#loc262)
      %35 = tpu.concatenate %34, %34, %34, %34, %34, %34, %34, %34 in 1 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32>, vector<1024x128xi32> -> vector<1024x1024xi32> loc(#loc263)
      %36 = arith.cmpi sge, %35, %33 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{*,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x1024xi32> loc(#loc264)
      %37 = arith.select %36, %29, %cst_0 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x1024xi1>, vector<1024x1024xf32> loc(#loc265)
      %38 = vector.multi_reduction <maximumf>, %37, %cst_4 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{*,*},(8,128),-2">], out_layout = [#tpu.vpad<"32,{0,*},(8,128),-1">]} [1] : vector<1024x1024xf32> to vector<1024xf32> loc(#loc266)
      %39 = vector.shape_cast %38 {in_layout = [#tpu.vpad<"32,{0,*},(8,128),-1">], out_layout = [#tpu.vpad<"32,{0,*},(8,128)">]} : vector<1024xf32> to vector<1024x1xf32> loc(#loc267)
      %40 = vector.broadcast %39 {in_layout = [#tpu.vpad<"32,{0,*},(8,128)">], out_layout = [#tpu.vpad<"32,{0,*},(8,128)">]} : vector<1024x1xf32> to vector<1024x128xf32> loc(#loc268)
      %41 = arith.maximumf %23, %40 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,*},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc268)
      %42 = tpu.concatenate %41, %41, %41, %41, %41, %41, %41, %41 in 1 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32>, vector<1024x128xf32> -> vector<1024x1024xf32> loc(#loc269)
      %43 = arith.subf %37, %42 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x1024xf32> loc(#loc270)
      %44 = math.exp %43 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x1024xf32> loc(#loc271)
      %45 = vector.multi_reduction <add>, %44, %cst_3 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{*,*},(8,128),-2">], out_layout = [#tpu.vpad<"32,{0,*},(8,128),-1">]} [1] : vector<1024x1024xf32> to vector<1024xf32> loc(#loc272)
      %46 = vector.shape_cast %45 {in_layout = [#tpu.vpad<"32,{0,*},(8,128),-1">], out_layout = [#tpu.vpad<"32,{0,*},(8,128)">]} : vector<1024xf32> to vector<1024x1xf32> loc(#loc273)
      %47 = vector.broadcast %46 {in_layout = [#tpu.vpad<"32,{0,*},(8,128)">], out_layout = [#tpu.vpad<"32,{0,*},(8,128)">]} : vector<1024x1xf32> to vector<1024x128xf32> loc(#loc273)
      %48 = arith.subf %23, %41 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc274)
      %49 = math.exp %48 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc275)
      %50 = arith.mulf %49, %24 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc276)
      %51 = arith.addf %47, %50 {in_layout = [#tpu.vpad<"32,{0,*},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc277)
      tpu.vector_store %8[%c0, %c0], %41 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc278)
      tpu.vector_store %10[%c0, %c0], %51 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc279)
      %52 = vector.load %4[%c0, %c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc280)
      %53 = vector.shape_cast %52 {in_layout = [#tpu.vpad<"16,{0,0},(8,128)">], out_layout = [#tpu.vpad<"16,{0,0},(8,128)">]} : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc280)
      %54 = arith.extf %53 {in_layout = [#tpu.vpad<"16,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xbf16> to vector<1024x128xf32> loc(#loc281)
      %55 = tpu.matmul %44, %54, %cst_2 {dimension_numbers = #tpu.dot_dimension_numbers<[1], [0], [0], [1], [0, 0, 1, 1], [], []>, in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x1024xf32>, vector<1024x128xf32>, vector<1024x128xf32> -> vector<1024x128xf32> loc(#loc282)
      %56 = vector.load %12[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc283)
      %57 = arith.mulf %49, %56 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc284)
      %58 = arith.addf %57, %55 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc285)
      tpu.vector_store %12[%c0, %c0], %58 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc286)
    } {in_layout = [#tpu.vpad<"none">]} loc(#loc197)
    %22 = arith.cmpi eq, %arg2, %c1_i32 {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 loc(#loc231)
    scf.if %22 {
      %23 = vector.load %10[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc287)
      %24 = arith.divf %cst, %23 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc288)
      %25 = vector.load %12[%c0, %c0] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc289)
      %26 = arith.mulf %25, %24 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"32,{0,0},(8,128)">]} : vector<1024x128xf32> loc(#loc290)
      %27 = arith.truncf %26 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">], out_layout = [#tpu.vpad<"16,{0,0},(16,128)">]} : vector<1024x128xf32> to vector<1024x128xbf16> loc(#loc291)
      %28 = vector.shape_cast %27 {in_layout = [#tpu.vpad<"16,{0,0},(16,128)">], out_layout = [#tpu.vpad<"16,{0,0},(16,128)">]} : vector<1024x128xbf16> to vector<1x1024x128xbf16> loc(#loc292)
      tpu.vector_store %13[%c0, %c0, %c0], %28 {in_layout = [#tpu.vpad<"16,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16>,  loc(#loc292)
      tpu.vector_store %8[%c0, %c0], %cst_2 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc293)
      tpu.vector_store %10[%c0, %c0], %cst_2 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc294)
      tpu.vector_store %12[%c0, %c0], %cst_2 {in_layout = [#tpu.vpad<"32,{0,0},(8,128)">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc295)
    } {in_layout = [#tpu.vpad<"none">]} loc(#loc232)
    return {in_layout = []} loc(#loc)
  } loc(#loc)
  func.func @transform_0(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">]} %arg0, %arg1, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_1(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    %c0 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : index loc(#loc)
    %0 = tpu.erase_memref_layout %arg3 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = arith.index_cast %arg1 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc296)
    %2 = arith.index_cast %arg2 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc296)
    %3 = memref.load %0[%c0, %1, %2] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc296)
    %4 = arith.extsi %3 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i8 to i32 loc(#loc297)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">]} %arg0, %4, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_2(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    %c0 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : index loc(#loc)
    %0 = tpu.erase_memref_layout %arg3 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = arith.index_cast %arg1 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc298)
    %2 = arith.index_cast %arg2 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i32 to index loc(#loc298)
    %3 = memref.load %0[%c0, %1, %2] {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc298)
    %4 = arith.extsi %3 {in_layout = [#tpu.vpad<"none">], out_layout = [#tpu.vpad<"none">]} : i8 to i32 loc(#loc299)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">]} %arg0, %4, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_3(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">]} %arg1, %c0_i32 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_4(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">]} %c0_i32, %c0_i32 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_5(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">]} %c0_i32, %c0_i32 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_6(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">]} %c0_i32, %c0_i32 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_7(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %c0_i32 = arith.constant {in_layout = [], out_layout = [#tpu.vpad<"none">]} 0 : i32 loc(#loc)
    return {in_layout = [#tpu.vpad<"none">, #tpu.vpad<"none">, #tpu.vpad<"none">]} %arg0, %arg1, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
} loc(#loc)
#loc1 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":722:11 to :17)
#loc2 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":1100:14 to 1138:5)
#loc3 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":1192:9 to 1206:3)
#loc4 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":2312:9 to 2328:3)
#loc5 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":2347:11 to 2354:5)
#loc6 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":64:19 to :39)
#loc7 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":70:17 to :32)
#loc8 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":153:32 to :94)
#loc9 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":191:4 to :10)
#loc10 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":722:3 to :18)
#loc11 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":724:4 to :22)
#loc12 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":725:4 to :22)
#loc13 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":726:4 to :22)
#loc14 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:22 to :45)
#loc15 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":728:52 to 735:3)
#loc16 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":567:21 to :40)
#loc17 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:15 to :46)
#loc18 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:15 to :50)
#loc19 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":576:18 to :40)
#loc20 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":576:11 to :41)
#loc21 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":806:3 to :22)
#loc22 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":739:21 to :39)
#loc23 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":812:4 to :56)
#loc24 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":739:41 to :59)
#loc25 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":743:8 to :18)
#loc26 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":746:10 to :27)
#loc27 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":749:9 to :71)
#loc28 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":767:17 to :38)
#loc29 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":618:30 to 620:7)
#loc30 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":772:9 to :34)
#loc31 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":618:19 to 620:7)
#loc32 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":625:10 to :29)
#loc33 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":624:19 to 626:7)
#loc34 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_mask.py":320:15 to :30)
#loc35 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":637:20 to :57)
#loc36 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":673:9 to :40)
#loc37 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":774:13 to :28)
#loc38 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":774:13 to :37)
#loc39 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":776:13 to :40)
#loc40 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:26 to :67)
#loc41 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:21 to :67)
#loc42 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:13 to :68)
#loc43 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":788:38 to :57)
#loc44 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":788:13 to :78)
#loc45 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":791:20 to :35)
#loc46 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":791:12 to :36)
#loc47 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":792:22 to :36)
#loc48 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":792:13 to :36)
#loc49 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":793:4 to :22)
#loc50 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":793:24 to :42)
#loc51 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":797:10 to :27)
#loc52 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":800:8 to :25)
#loc53 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":801:13 to :48)
#loc54 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:33 to :49)
#loc55 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:23 to :49)
#loc56 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:23 to :58)
#loc57 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:4 to :20)
#loc58 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":814:11 to :30)
#loc59 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":814:3 to :31)
#loc60 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":816:8 to :26)
#loc61 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":817:25 to :32)
#loc62 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:18 to :36)
#loc63 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:18 to :44)
#loc64 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:17 to :65)
#loc65 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:4 to :14)
#loc66 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":825:4 to :22)
#loc67 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":826:4 to :22)
#loc68 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":827:4 to :22)
#loc69 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":969:17 to 971:5)
#loc70 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":977:17 to 979:5)
#loc71 = loc("flash_attention_kernel"(#loc1))
#loc72 = loc("_splash_attention_forward"(#loc2))
#loc73 = loc("_splash_attention_custom"(#loc3))
#loc74 = loc("_splash_attention"(#loc4))
#loc75 = loc("SplashAttentionKernel.__call__"(#loc5))
#loc76 = loc("benchmark_kernel.<locals>.splash_attention_kernel"(#loc6))
#loc77 = loc("benchmark_kernel"(#loc7))
#loc78 = loc("main"(#loc8))
#loc79 = loc("<module>"(#loc9))
#loc80 = loc("flash_attention_kernel"(#loc10))
#loc81 = loc("flash_attention_kernel.<locals>.init"(#loc11))
#loc82 = loc("flash_attention_kernel.<locals>.init"(#loc12))
#loc83 = loc("flash_attention_kernel.<locals>.init"(#loc13))
#loc84 = loc("_next_nonzero"(#loc14))
#loc85 = loc("flash_attention_kernel"(#loc15))
#loc86 = loc("_next_nonzero.<locals>.<lambda>"(#loc16))
#loc87 = loc("_next_nonzero"(#loc17))
#loc88 = loc("_next_nonzero"(#loc18))
#loc89 = loc("_next_nonzero"(#loc19))
#loc90 = loc("_next_nonzero"(#loc20))
#loc91 = loc("flash_attention_kernel"(#loc21))
#loc92 = loc("flash_attention_kernel.<locals>.body"(#loc22))
#loc93 = loc("flash_attention_kernel.<locals>.run"(#loc23))
#loc94 = loc("flash_attention_kernel.<locals>.body"(#loc24))
#loc95 = loc("flash_attention_kernel.<locals>.body"(#loc25))
#loc96 = loc("flash_attention_kernel.<locals>.body"(#loc26))
#loc97 = loc("flash_attention_kernel.<locals>.body"(#loc27))
#loc98 = loc("flash_attention_kernel.<locals>.body"(#loc28))
#loc99 = loc("_apply_mask_and_soft_cap"(#loc29))
#loc100 = loc("flash_attention_kernel.<locals>.body"(#loc30))
#loc101 = loc("_apply_mask_and_soft_cap"(#loc31))
#loc102 = loc("_apply_mask_and_soft_cap"(#loc32))
#loc103 = loc("_apply_mask_and_soft_cap"(#loc33))
#loc104 = loc("CausalMask.__init__.<locals>.causal_mask_function"(#loc34))
#loc105 = loc("_apply_mask_and_soft_cap"(#loc35))
#loc106 = loc("_apply_mask_and_soft_cap"(#loc36))
#loc107 = loc("flash_attention_kernel.<locals>.body"(#loc37))
#loc108 = loc("flash_attention_kernel.<locals>.body"(#loc38))
#loc109 = loc("flash_attention_kernel.<locals>.body"(#loc39))
#loc110 = loc("flash_attention_kernel.<locals>.body"(#loc40))
#loc111 = loc("flash_attention_kernel.<locals>.body"(#loc41))
#loc112 = loc("flash_attention_kernel.<locals>.body"(#loc42))
#loc113 = loc("flash_attention_kernel.<locals>.body"(#loc43))
#loc114 = loc("flash_attention_kernel.<locals>.body"(#loc44))
#loc115 = loc("flash_attention_kernel.<locals>.body"(#loc45))
#loc116 = loc("flash_attention_kernel.<locals>.body"(#loc46))
#loc117 = loc("flash_attention_kernel.<locals>.body"(#loc47))
#loc118 = loc("flash_attention_kernel.<locals>.body"(#loc48))
#loc119 = loc("flash_attention_kernel.<locals>.body"(#loc49))
#loc120 = loc("flash_attention_kernel.<locals>.body"(#loc50))
#loc121 = loc("flash_attention_kernel.<locals>.body"(#loc51))
#loc122 = loc("flash_attention_kernel.<locals>.body"(#loc52))
#loc123 = loc("flash_attention_kernel.<locals>.body"(#loc53))
#loc124 = loc("flash_attention_kernel.<locals>.body"(#loc54))
#loc125 = loc("flash_attention_kernel.<locals>.body"(#loc55))
#loc126 = loc("flash_attention_kernel.<locals>.body"(#loc56))
#loc127 = loc("flash_attention_kernel.<locals>.body"(#loc57))
#loc128 = loc("flash_attention_kernel"(#loc58))
#loc129 = loc("flash_attention_kernel"(#loc59))
#loc130 = loc("flash_attention_kernel.<locals>.end"(#loc60))
#loc131 = loc("flash_attention_kernel.<locals>.end"(#loc61))
#loc132 = loc("flash_attention_kernel.<locals>.end"(#loc62))
#loc133 = loc("flash_attention_kernel.<locals>.end"(#loc63))
#loc134 = loc("flash_attention_kernel.<locals>.end"(#loc64))
#loc135 = loc("flash_attention_kernel.<locals>.end"(#loc65))
#loc136 = loc("flash_attention_kernel.<locals>.end"(#loc66))
#loc137 = loc("flash_attention_kernel.<locals>.end"(#loc67))
#loc138 = loc("flash_attention_kernel.<locals>.end"(#loc68))
#loc139 = loc("_splash_attention_forward.<locals>.k_index_map"(#loc69))
#loc140 = loc("_splash_attention_forward.<locals>.v_index_map"(#loc70))
#loc141 = loc(callsite(#loc78 at #loc79))
#loc142 = loc(callsite(#loc77 at #loc78))
#loc143 = loc(callsite(#loc76 at #loc77))
#loc144 = loc(callsite(#loc75 at #loc76))
#loc145 = loc(callsite(#loc77 at #loc141))
#loc146 = loc(callsite(#loc76 at #loc142))
#loc147 = loc(callsite(#loc75 at #loc143))
#loc148 = loc(callsite(#loc74 at #loc144))
#loc149 = loc(callsite(#loc76 at #loc145))
#loc150 = loc(callsite(#loc75 at #loc146))
#loc151 = loc(callsite(#loc74 at #loc147))
#loc152 = loc(callsite(#loc73 at #loc148))
#loc153 = loc(callsite(#loc75 at #loc149))
#loc154 = loc(callsite(#loc74 at #loc150))
#loc155 = loc(callsite(#loc73 at #loc151))
#loc156 = loc(callsite(#loc72 at #loc152))
#loc157 = loc(callsite(#loc74 at #loc153))
#loc158 = loc(callsite(#loc73 at #loc154))
#loc159 = loc(callsite(#loc72 at #loc155))
#loc160 = loc(callsite(#loc91 at #loc156))
#loc161 = loc(callsite(#loc73 at #loc157))
#loc162 = loc(callsite(#loc72 at #loc158))
#loc163 = loc(callsite(#loc91 at #loc159))
#loc164 = loc(callsite(#loc93 at #loc160))
#loc165 = loc(callsite(#loc72 at #loc161))
#loc166 = loc(callsite(#loc85 at #loc162))
#loc167 = loc(callsite(#loc91 at #loc162))
#loc168 = loc(callsite(#loc93 at #loc163))
#loc169 = loc(callsite(#loc100 at #loc164))
#loc170 = loc(callsite(#loc139 at #loc162))
#loc171 = loc(callsite(#loc140 at #loc162))
#loc172 = loc(callsite(#loc71 at #loc165))
#loc173 = loc(callsite(#loc80 at #loc165))
#loc174 = loc(callsite(#loc85 at #loc165))
#loc175 = loc(callsite(#loc87 at #loc166))
#loc176 = loc(callsite(#loc90 at #loc166))
#loc177 = loc(callsite(#loc91 at #loc165))
#loc178 = loc(callsite(#loc93 at #loc167))
#loc179 = loc(callsite(#loc100 at #loc168))
#loc180 = loc(callsite(#loc105 at #loc169))
#loc181 = loc(callsite(#loc128 at #loc165))
#loc182 = loc(callsite(#loc129 at #loc165))
#loc183 = loc(callsite(#loc139 at #loc165))
#loc184 = loc(callsite(#loc90 at #loc170))
#loc185 = loc(callsite(#loc140 at #loc165))
#loc186 = loc(callsite(#loc90 at #loc171))
#loc187 = loc("/eq"(#loc172))
#loc188 = loc("/cond"(#loc173))
#loc189 = loc(callsite(#loc81 at #loc173))
#loc190 = loc(callsite(#loc82 at #loc173))
#loc191 = loc(callsite(#loc83 at #loc173))
#loc192 = loc(callsite(#loc84 at #loc174))
#loc193 = loc(callsite(#loc86 at #loc175))
#loc194 = loc(callsite(#loc88 at #loc174))
#loc195 = loc(callsite(#loc89 at #loc174))
#loc196 = loc(callsite(#loc86 at #loc176))
#loc197 = loc("/cond"(#loc177))
#loc198 = loc(callsite(#loc92 at #loc178))
#loc199 = loc(callsite(#loc94 at #loc178))
#loc200 = loc(callsite(#loc95 at #loc178))
#loc201 = loc(callsite(#loc96 at #loc178))
#loc202 = loc(callsite(#loc97 at #loc178))
#loc203 = loc(callsite(#loc98 at #loc178))
#loc204 = loc(callsite(#loc99 at #loc179))
#loc205 = loc(callsite(#loc101 at #loc179))
#loc206 = loc(callsite(#loc102 at #loc179))
#loc207 = loc(callsite(#loc103 at #loc179))
#loc208 = loc(callsite(#loc104 at #loc180))
#loc209 = loc(callsite(#loc106 at #loc179))
#loc210 = loc(callsite(#loc107 at #loc178))
#loc211 = loc(callsite(#loc108 at #loc178))
#loc212 = loc(callsite(#loc109 at #loc178))
#loc213 = loc(callsite(#loc110 at #loc178))
#loc214 = loc(callsite(#loc111 at #loc178))
#loc215 = loc(callsite(#loc112 at #loc178))
#loc216 = loc(callsite(#loc113 at #loc178))
#loc217 = loc(callsite(#loc114 at #loc178))
#loc218 = loc(callsite(#loc115 at #loc178))
#loc219 = loc(callsite(#loc116 at #loc178))
#loc220 = loc(callsite(#loc117 at #loc178))
#loc221 = loc(callsite(#loc118 at #loc178))
#loc222 = loc(callsite(#loc119 at #loc178))
#loc223 = loc(callsite(#loc120 at #loc178))
#loc224 = loc(callsite(#loc121 at #loc178))
#loc225 = loc(callsite(#loc122 at #loc178))
#loc226 = loc(callsite(#loc123 at #loc178))
#loc227 = loc(callsite(#loc124 at #loc178))
#loc228 = loc(callsite(#loc125 at #loc178))
#loc229 = loc(callsite(#loc126 at #loc178))
#loc230 = loc(callsite(#loc127 at #loc178))
#loc231 = loc("/eq"(#loc181))
#loc232 = loc("/cond"(#loc182))
#loc233 = loc(callsite(#loc130 at #loc182))
#loc234 = loc(callsite(#loc131 at #loc182))
#loc235 = loc(callsite(#loc132 at #loc182))
#loc236 = loc(callsite(#loc133 at #loc182))
#loc237 = loc(callsite(#loc134 at #loc182))
#loc238 = loc(callsite(#loc135 at #loc182))
#loc239 = loc(callsite(#loc136 at #loc182))
#loc240 = loc(callsite(#loc137 at #loc182))
#loc241 = loc(callsite(#loc138 at #loc182))
#loc242 = loc(callsite(#loc89 at #loc183))
#loc243 = loc(callsite(#loc86 at #loc184))
#loc244 = loc(callsite(#loc89 at #loc185))
#loc245 = loc(callsite(#loc86 at #loc186))
#loc246 = loc("/swap"(#loc189))
#loc247 = loc("/swap"(#loc190))
#loc248 = loc("/swap"(#loc191))
#loc249 = loc("/get"(#loc192))
#loc250 = loc("/convert_element_type"(#loc193))
#loc251 = loc("/gt"(#loc194))
#loc252 = loc("/get"(#loc195))
#loc253 = loc("/convert_element_type"(#loc196))
#loc254 = loc("/get"(#loc198))
#loc255 = loc("/get"(#loc199))
#loc256 = loc("/get"(#loc200))
#loc257 = loc("/get"(#loc201))
#loc258 = loc("/dot_general"(#loc202))
#loc259 = loc("/mul"(#loc203))
#loc260 = loc("/iota"(#loc204))
#loc261 = loc("/add"(#loc205))
#loc262 = loc("/get"(#loc206))
#loc263 = loc("/repeat"(#loc207))
#loc264 = loc("/ge"(#loc208))
#loc265 = loc("/select_n"(#loc209))
#loc266 = loc("/reduce_max"(#loc210))
#loc267 = loc("/broadcast_in_dim"(#loc211))
#loc268 = loc("/max"(#loc212))
#loc269 = loc("/repeat"(#loc213))
#loc270 = loc("/sub"(#loc214))
#loc271 = loc("/exp"(#loc215))
#loc272 = loc("/reduce_sum"(#loc216))
#loc273 = loc("/broadcast_in_dim"(#loc217))
#loc274 = loc("/sub"(#loc218))
#loc275 = loc("/exp"(#loc219))
#loc276 = loc("/mul"(#loc220))
#loc277 = loc("/add"(#loc221))
#loc278 = loc("/swap"(#loc222))
#loc279 = loc("/swap"(#loc223))
#loc280 = loc("/get"(#loc224))
#loc281 = loc("/convert_element_type"(#loc225))
#loc282 = loc("/dot_general"(#loc226))
#loc283 = loc("/get"(#loc227))
#loc284 = loc("/mul"(#loc228))
#loc285 = loc("/add"(#loc229))
#loc286 = loc("/swap"(#loc230))
#loc287 = loc("/get"(#loc233))
#loc288 = loc("/div"(#loc234))
#loc289 = loc("/get"(#loc235))
#loc290 = loc("/mul"(#loc236))
#loc291 = loc("/convert_element_type"(#loc237))
#loc292 = loc("/swap"(#loc238))
#loc293 = loc("/swap"(#loc239))
#loc294 = loc("/swap"(#loc240))
#loc295 = loc("/swap"(#loc241))
#loc296 = loc("/get"(#loc242))
#loc297 = loc("/convert_element_type"(#loc243))
#loc298 = loc("/get"(#loc244))
#loc299 = loc("/convert_element_type"(#loc245))
