#loc = loc(unknown)
module @splash_mha_fwd_c602b16d {
  func.func @main(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg5: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg6: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg7: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg8: memref<1024x128xi32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg9: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg10: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg11: memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> loc(unknown), %arg12: memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> loc(unknown)) attributes {dimension_semantics = [#tpu.dimension_semantics<parallel>, #tpu.dimension_semantics<arbitrary>, #tpu.dimension_semantics<arbitrary>], iteration_bounds = array<i64: 8, 2, 2>, scalar_prefetch = 2 : i64, scratch_operands = 0 : i64, window_params = [{transform_indices = @transform_0, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_1, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_2, window_bounds = array<i64: 1, 1024, 128>}, {transform_indices = @transform_3, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_4, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_5, window_bounds = array<i64: 1024, 128>}, {pipeline_mode = #tpu.pipeline_mode<synchronous>, transform_indices = @transform_6, window_bounds = array<i64: 1024, 128>}, {transform_indices = @transform_7, window_bounds = array<i64: 1, 1024, 128>}]} {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %2 = tpu.erase_memref_layout %arg5 : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %3 = tpu.erase_memref_layout %arg6 : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %4 = tpu.erase_memref_layout %arg7 : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %5 = tpu.reinterpret_cast %arg8 : memref<1024x128xi32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xi32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %6 = tpu.erase_memref_layout %5 : memref<1024x128xi32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xi32, #tpu.memory_space<vmem>> loc(#loc)
    %7 = tpu.reinterpret_cast %arg9 : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %8 = tpu.erase_memref_layout %7 : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %9 = tpu.reinterpret_cast %arg10 : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %10 = tpu.erase_memref_layout %9 : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %11 = tpu.reinterpret_cast %arg11 : memref<1024x128xf32, #tpu.tiled<(8,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> loc(#loc)
    %12 = tpu.erase_memref_layout %11 : memref<1024x128xf32, #tpu.tiled<(1,128),[1,1]>, #tpu.memory_space<vmem>> -> memref<1024x128xf32, #tpu.memory_space<vmem>> loc(#loc)
    %13 = tpu.erase_memref_layout %arg12 : memref<1x1024x128xbf16, #tpu.tiled<(8,128)(2,1),[128,1,1]>, #tpu.memory_space<vmem>> -> memref<1x1024x128xbf16, #tpu.memory_space<vmem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc211)
    %14 = arith.cmpi eq, %arg2, %c0_i32 : i32 loc(#loc211)
    %15 = arith.extui %14 : i1 to i32 loc(#loc212)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc213)
    %16 = arith.cmpi ne, %15, %c0_i32_0 : i32 loc(#loc213)
    scf.if %16 {
      %cst = arith.constant 0.000000e+00 : f32 loc(#loc291)
      %31 = vector.broadcast %cst : f32 to vector<1024x128xf32> loc(#loc291)
      %c0_5 = arith.constant 0 : index loc(#loc292)
      %c0_6 = arith.constant 0 : index loc(#loc292)
      %32 = vector.load %12[%c0_5, %c0_6] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc292)
      tpu.vector_store %12[%c0_5, %c0_6], %31 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc292)
      %cst_7 = arith.constant -2.38197633E+38 : f32 loc(#loc293)
      %33 = vector.broadcast %cst_7 : f32 to vector<1024x128xf32> loc(#loc293)
      %c0_8 = arith.constant 0 : index loc(#loc294)
      %c0_9 = arith.constant 0 : index loc(#loc294)
      %34 = vector.load %8[%c0_8, %c0_9] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc294)
      tpu.vector_store %8[%c0_8, %c0_9], %33 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc294)
      %cst_10 = arith.constant 0.000000e+00 : f32 loc(#loc295)
      %35 = vector.broadcast %cst_10 : f32 to vector<1024x128xf32> loc(#loc295)
      %c0_11 = arith.constant 0 : index loc(#loc296)
      %c0_12 = arith.constant 0 : index loc(#loc296)
      %36 = vector.load %10[%c0_11, %c0_12] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc296)
      tpu.vector_store %10[%c0_11, %c0_12], %35 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc296)
    } else {
    } loc(#loc213)
    %c0 = arith.constant 0 : index loc(#loc297)
    %17 = arith.index_cast %arg1 : i32 to index loc(#loc297)
    %18 = arith.index_cast %arg2 : i32 to index loc(#loc297)
    %19 = memref.load %1[%c0, %17, %18] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc297)
    %20 = arith.extsi %19 : i8 to i32 loc(#loc298)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc299)
    %21 = arith.cmpi sgt, %20, %c0_i32_1 : i32 loc(#loc299)
    %c0_2 = arith.constant 0 : index loc(#loc300)
    %22 = arith.index_cast %arg1 : i32 to index loc(#loc300)
    %23 = arith.index_cast %arg2 : i32 to index loc(#loc300)
    %24 = memref.load %0[%c0_2, %22, %23] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc300)
    %25 = arith.extsi %24 : i8 to i32 loc(#loc301)
    %26 = arith.extui %21 : i1 to i32 loc(#loc225)
    %c0_i32_3 = arith.constant 0 : i32 loc(#loc226)
    %27 = arith.cmpi ne, %26, %c0_i32_3 : i32 loc(#loc226)
    scf.if %27 {
      %c0_i32_5 = arith.constant 0 : i32 loc(#loc302)
      %c1024_i32 = arith.constant 1024 : i32 loc(#loc303)
      %31 = arith.muli %c0_i32_5, %c1024_i32 : i32 loc(#loc303)
      %c0_6 = arith.constant 0 : index loc(#loc304)
      %c0_7 = arith.constant 0 : index loc(#loc304)
      %32 = vector.load %8[%c0_6, %c0_7] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc304)
      %c0_8 = arith.constant 0 : index loc(#loc305)
      %c0_9 = arith.constant 0 : index loc(#loc305)
      %33 = vector.load %10[%c0_8, %c0_9] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc305)
      %c0_10 = arith.constant 0 : index loc(#loc306)
      %c0_11 = arith.constant 0 : index loc(#loc306)
      %c0_12 = arith.constant 0 : index loc(#loc306)
      %34 = vector.load %2[%c0_10, %c0_11, %c0_12] : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc306)
      %35 = vector.shape_cast %34 : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc306)
      %c0_13 = arith.constant 0 : index loc(#loc307)
      %36 = arith.index_cast %31 : i32 to index loc(#loc307)
      %c0_14 = arith.constant 0 : index loc(#loc307)
      %37 = vector.load %3[%c0_13, %36, %c0_14] : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc307)
      %38 = vector.shape_cast %37 : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc307)
      %cst = arith.constant dense<0.000000e+00> : vector<1024x1024xf32> loc(#loc308)
      %39 = tpu.matmul %35, %38, %cst {dimension_numbers = #tpu.dot_dimension_numbers<[1], [1], [0], [0], [0, 0, 1, 0], [], []>} : vector<1024x128xbf16>, vector<1024x128xbf16>, vector<1024x1024xf32> -> vector<1024x1024xf32> loc(#loc308)
      %c1024_i32_15 = arith.constant 1024 : i32 loc(#loc309)
      %40 = arith.muli %25, %c1024_i32_15 : i32 loc(#loc309)
      %c1024_i32_16 = arith.constant 1024 : i32 loc(#loc310)
      %41 = arith.muli %c0_i32_5, %c1024_i32_16 : i32 loc(#loc310)
      %42 = arith.addi %40, %41 : i32 loc(#loc311)
      %43 = tpu.iota {dimension = 1 : i32} : vector<1024x1024xi32> loc(#loc312)
      %44 = vector.broadcast %42 : i32 to vector<1024x1024xi32> loc(#loc313)
      %45 = arith.addi %44, %43 : vector<1024x1024xi32> loc(#loc313)
      %c0_17 = arith.constant 0 : index loc(#loc314)
      %c0_18 = arith.constant 0 : index loc(#loc314)
      %46 = vector.load %6[%c0_17, %c0_18] : memref<1024x128xi32, #tpu.memory_space<vmem>>, vector<1024x128xi32> loc(#loc314)
      %47 = tpu.repeat %46, 1 x 8 : vector<1024x128xi32> -> vector<1024x1024xi32> loc(#loc315)
      %48 = arith.cmpi sge, %47, %45 : vector<1024x1024xi32> loc(#loc316)
      %cst_19 = arith.constant -2.38197633E+38 : f32 loc(#loc317)
      %49 = vector.broadcast %cst_19 : f32 to vector<1024x1024xf32> loc(#loc318)
      %50 = arith.select %48, %39, %49 : vector<1024x1024xi1>, vector<1024x1024xf32> loc(#loc319)
      %cst_20 = arith.constant dense<0xFF800000> : vector<1024xf32> loc(#loc320)
      %51 = vector.multi_reduction <maximumf>, %50, %cst_20 [1] : vector<1024x1024xf32> to vector<1024xf32> loc(#loc320)
      %52 = vector.shape_cast %51 : vector<1024xf32> to vector<1024x1xf32> loc(#loc321)
      %53 = vector.broadcast %52 : vector<1024x1xf32> to vector<1024x128xf32> loc(#loc322)
      %54 = arith.maximumf %32, %53 : vector<1024x128xf32> loc(#loc322)
      %55 = tpu.repeat %54, 1 x 8 : vector<1024x128xf32> -> vector<1024x1024xf32> loc(#loc323)
      %56 = arith.subf %50, %55 : vector<1024x1024xf32> loc(#loc324)
      %57 = math.exp %56 : vector<1024x1024xf32> loc(#loc325)
      %cst_21 = arith.constant dense<0.000000e+00> : vector<1024xf32> loc(#loc326)
      %58 = vector.multi_reduction <add>, %57, %cst_21 [1] : vector<1024x1024xf32> to vector<1024xf32> loc(#loc326)
      %59 = vector.shape_cast %58 : vector<1024xf32> to vector<1024x1xf32> loc(#loc327)
      %60 = vector.broadcast %59 : vector<1024x1xf32> to vector<1024x128xf32> loc(#loc327)
      %61 = arith.subf %32, %54 : vector<1024x128xf32> loc(#loc328)
      %62 = math.exp %61 : vector<1024x128xf32> loc(#loc329)
      %63 = arith.mulf %62, %33 : vector<1024x128xf32> loc(#loc330)
      %64 = arith.addf %60, %63 : vector<1024x128xf32> loc(#loc331)
      %c0_22 = arith.constant 0 : index loc(#loc332)
      %c0_23 = arith.constant 0 : index loc(#loc332)
      %65 = vector.load %8[%c0_22, %c0_23] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc332)
      tpu.vector_store %8[%c0_22, %c0_23], %54 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc332)
      %c0_24 = arith.constant 0 : index loc(#loc333)
      %c0_25 = arith.constant 0 : index loc(#loc333)
      %66 = vector.load %10[%c0_24, %c0_25] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc333)
      tpu.vector_store %10[%c0_24, %c0_25], %64 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc333)
      %c0_26 = arith.constant 0 : index loc(#loc334)
      %67 = arith.index_cast %31 : i32 to index loc(#loc334)
      %c0_27 = arith.constant 0 : index loc(#loc334)
      %68 = vector.load %4[%c0_26, %67, %c0_27] : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc334)
      %69 = vector.shape_cast %68 : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc334)
      %70 = arith.extf %69 : vector<1024x128xbf16> to vector<1024x128xf32> loc(#loc335)
      %cst_28 = arith.constant dense<0.000000e+00> : vector<1024x128xf32> loc(#loc336)
      %71 = tpu.matmul %57, %70, %cst_28 {dimension_numbers = #tpu.dot_dimension_numbers<[1], [0], [0], [1], [0, 0, 1, 1], [], []>} : vector<1024x1024xf32>, vector<1024x128xf32>, vector<1024x128xf32> -> vector<1024x128xf32> loc(#loc336)
      %72 = tpu.repeat %62, 1 x 1 : vector<1024x128xf32> -> vector<1024x128xf32> loc(#loc337)
      %c0_29 = arith.constant 0 : index loc(#loc338)
      %c0_30 = arith.constant 0 : index loc(#loc338)
      %73 = vector.load %12[%c0_29, %c0_30] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc338)
      %74 = arith.mulf %72, %73 : vector<1024x128xf32> loc(#loc339)
      %75 = arith.addf %74, %71 : vector<1024x128xf32> loc(#loc340)
      %c0_31 = arith.constant 0 : index loc(#loc341)
      %c0_32 = arith.constant 0 : index loc(#loc341)
      %76 = vector.load %12[%c0_31, %c0_32] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc341)
      tpu.vector_store %12[%c0_31, %c0_32], %75 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc341)
      %c1_i32_33 = arith.constant 1 : i32 loc(#loc302)
    } else {
    } loc(#loc226)
    %c1_i32 = arith.constant 1 : i32 loc(#loc265)
    %28 = arith.cmpi eq, %arg2, %c1_i32 : i32 loc(#loc265)
    %29 = arith.extui %28 : i1 to i32 loc(#loc266)
    %c0_i32_4 = arith.constant 0 : i32 loc(#loc267)
    %30 = arith.cmpi ne, %29, %c0_i32_4 : i32 loc(#loc267)
    scf.if %30 {
      %c0_5 = arith.constant 0 : index loc(#loc342)
      %c0_6 = arith.constant 0 : index loc(#loc342)
      %31 = vector.load %10[%c0_5, %c0_6] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc342)
      %cst = arith.constant 1.000000e+00 : f32 loc(#loc343)
      %32 = vector.broadcast %cst : f32 to vector<1024x128xf32> loc(#loc343)
      %33 = arith.divf %32, %31 : vector<1024x128xf32> loc(#loc343)
      %34 = tpu.repeat %33, 1 x 1 : vector<1024x128xf32> -> vector<1024x128xf32> loc(#loc344)
      %c0_7 = arith.constant 0 : index loc(#loc345)
      %c0_8 = arith.constant 0 : index loc(#loc345)
      %35 = vector.load %12[%c0_7, %c0_8] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc345)
      %36 = arith.mulf %35, %34 : vector<1024x128xf32> loc(#loc346)
      %37 = arith.truncf %36 : vector<1024x128xf32> to vector<1024x128xbf16> loc(#loc347)
      %c0_9 = arith.constant 0 : index loc(#loc348)
      %c0_10 = arith.constant 0 : index loc(#loc348)
      %c0_11 = arith.constant 0 : index loc(#loc348)
      %38 = vector.load %13[%c0_9, %c0_10, %c0_11] : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16> loc(#loc348)
      %39 = vector.shape_cast %38 : vector<1x1024x128xbf16> to vector<1024x128xbf16> loc(#loc348)
      %40 = vector.shape_cast %37 : vector<1024x128xbf16> to vector<1x1024x128xbf16> loc(#loc348)
      tpu.vector_store %13[%c0_9, %c0_10, %c0_11], %40 {strides = array<i32>} : memref<1x1024x128xbf16, #tpu.memory_space<vmem>>, vector<1x1024x128xbf16>,  loc(#loc348)
      %cst_12 = arith.constant 0.000000e+00 : f32 loc(#loc349)
      %41 = vector.broadcast %cst_12 : f32 to vector<1024x128xf32> loc(#loc349)
      %c0_13 = arith.constant 0 : index loc(#loc350)
      %c0_14 = arith.constant 0 : index loc(#loc350)
      %42 = vector.load %8[%c0_13, %c0_14] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc350)
      tpu.vector_store %8[%c0_13, %c0_14], %41 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc350)
      %cst_15 = arith.constant 0.000000e+00 : f32 loc(#loc351)
      %43 = vector.broadcast %cst_15 : f32 to vector<1024x128xf32> loc(#loc351)
      %c0_16 = arith.constant 0 : index loc(#loc352)
      %c0_17 = arith.constant 0 : index loc(#loc352)
      %44 = vector.load %10[%c0_16, %c0_17] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc352)
      tpu.vector_store %10[%c0_16, %c0_17], %43 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc352)
      %cst_18 = arith.constant 0.000000e+00 : f32 loc(#loc353)
      %45 = vector.broadcast %cst_18 : f32 to vector<1024x128xf32> loc(#loc353)
      %c0_19 = arith.constant 0 : index loc(#loc354)
      %c0_20 = arith.constant 0 : index loc(#loc354)
      %46 = vector.load %12[%c0_19, %c0_20] : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32> loc(#loc354)
      tpu.vector_store %12[%c0_19, %c0_20], %45 {strides = array<i32>} : memref<1024x128xf32, #tpu.memory_space<vmem>>, vector<1024x128xf32>,  loc(#loc354)
    } else {
    } loc(#loc267)
    return loc(#loc)
  } loc(#loc)
  func.func @transform_0(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    return %arg0, %arg1, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_1(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0 = arith.constant 0 : index loc(#loc355)
    %2 = arith.index_cast %arg1 : i32 to index loc(#loc355)
    %3 = arith.index_cast %arg2 : i32 to index loc(#loc355)
    %4 = memref.load %1[%c0, %2, %3] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc355)
    %5 = arith.extsi %4 : i8 to i32 loc(#loc356)
    %c0_i32 = arith.constant 0 : i32 loc(#loc357)
    %6 = arith.cmpi sgt, %5, %c0_i32 : i32 loc(#loc357)
    %c0_0 = arith.constant 0 : index loc(#loc358)
    %7 = arith.index_cast %arg1 : i32 to index loc(#loc358)
    %8 = arith.index_cast %arg2 : i32 to index loc(#loc358)
    %9 = memref.load %0[%c0_0, %7, %8] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc358)
    %10 = arith.extsi %9 : i8 to i32 loc(#loc359)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_2 = arith.constant 0 : i32 loc(#loc)
    return %arg0, %10, %c0_i32_1 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_2(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0 = arith.constant 0 : index loc(#loc360)
    %2 = arith.index_cast %arg1 : i32 to index loc(#loc360)
    %3 = arith.index_cast %arg2 : i32 to index loc(#loc360)
    %4 = memref.load %1[%c0, %2, %3] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc360)
    %5 = arith.extsi %4 : i8 to i32 loc(#loc361)
    %c0_i32 = arith.constant 0 : i32 loc(#loc362)
    %6 = arith.cmpi sgt, %5, %c0_i32 : i32 loc(#loc362)
    %c0_0 = arith.constant 0 : index loc(#loc363)
    %7 = arith.index_cast %arg1 : i32 to index loc(#loc363)
    %8 = arith.index_cast %arg2 : i32 to index loc(#loc363)
    %9 = memref.load %0[%c0_0, %7, %8] : memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc363)
    %10 = arith.extsi %9 : i8 to i32 loc(#loc364)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_2 = arith.constant 0 : i32 loc(#loc)
    return %arg0, %10, %c0_i32_1 : i32, i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_3(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    return %arg1, %c0_i32 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_4(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc)
    return %c0_i32, %c0_i32_0 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_5(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc)
    return %c0_i32, %c0_i32_0 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_6(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_1 = arith.constant 0 : i32 loc(#loc)
    return %c0_i32, %c0_i32_0 : i32, i32 loc(#loc)
  } loc(#loc)
  func.func @transform_7(%arg0: i32 loc(unknown), %arg1: i32 loc(unknown), %arg2: i32 loc(unknown), %arg3: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown), %arg4: memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> loc(unknown)) -> (i32, i32, i32) {
    %0 = tpu.erase_memref_layout %arg3 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %1 = tpu.erase_memref_layout %arg4 : memref<1x4x128xi8, #tpu.tiled<(4,128)(4,1),[1,1,1]>, #tpu.memory_space<smem>> -> memref<1x4x128xi8, #tpu.memory_space<smem>> loc(#loc)
    %c0_i32 = arith.constant 0 : i32 loc(#loc)
    %c0_i32_0 = arith.constant 0 : i32 loc(#loc)
    return %arg0, %arg1, %c0_i32 : i32, i32, i32 loc(#loc)
  } loc(#loc)
} loc(#loc)
#loc1 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":722:11 to :17)
#loc2 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":1100:14 to 1138:5)
#loc3 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":1192:9 to 1206:3)
#loc4 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":2312:9 to 2328:3)
#loc5 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":2347:11 to 2354:5)
#loc6 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":64:19 to :39)
#loc7 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":70:17 to :32)
#loc8 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":153:32 to :94)
#loc9 = loc("/home/ptoulme/justabyte/tpu_pallas_post/./pallas_kernel.py":191:4 to :10)
#loc10 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":722:3 to :18)
#loc11 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":724:25 to :54)
#loc12 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":724:4 to :22)
#loc13 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":725:25 to :65)
#loc14 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":725:4 to :22)
#loc15 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":726:25 to :54)
#loc16 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":726:4 to :22)
#loc17 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:22 to :45)
#loc18 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":728:52 to 735:3)
#loc19 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":567:21 to :40)
#loc20 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:15 to :46)
#loc21 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":569:15 to :50)
#loc22 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":576:18 to :40)
#loc23 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":576:11 to :41)
#loc24 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":806:3 to :22)
#loc25 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":812:4 to :56)
#loc26 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":738:20 to :50)
#loc27 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":739:21 to :39)
#loc28 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":739:41 to :59)
#loc29 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":743:8 to :18)
#loc30 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":746:10 to :27)
#loc31 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":749:9 to :71)
#loc32 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":767:17 to :38)
#loc33 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":767:41 to :71)
#loc34 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":767:17 to :71)
#loc35 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":618:30 to 620:7)
#loc36 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":772:9 to :34)
#loc37 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":618:19 to 620:7)
#loc38 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":625:10 to :29)
#loc39 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":624:19 to 626:7)
#loc40 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_mask.py":320:15 to :30)
#loc41 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":637:20 to :57)
#loc42 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":673:9 to :40)
#loc43 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":774:13 to :28)
#loc44 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":774:13 to :37)
#loc45 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":776:13 to :40)
#loc46 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:26 to :67)
#loc47 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:21 to :67)
#loc48 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":785:13 to :68)
#loc49 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":788:38 to :57)
#loc50 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":788:13 to :78)
#loc51 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":791:20 to :35)
#loc52 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":791:12 to :36)
#loc53 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":792:22 to :36)
#loc54 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":792:13 to :36)
#loc55 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":793:4 to :22)
#loc56 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":793:24 to :42)
#loc57 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":797:10 to :27)
#loc58 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":800:8 to :25)
#loc59 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":801:13 to :48)
#loc60 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":803:14 to :61)
#loc61 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:33 to :49)
#loc62 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:23 to :49)
#loc63 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:23 to :58)
#loc64 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":804:4 to :20)
#loc65 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":814:11 to :30)
#loc66 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":814:3 to :31)
#loc67 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":816:8 to :26)
#loc68 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":817:25 to :32)
#loc69 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":817:12 to :61)
#loc70 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:18 to :36)
#loc71 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:18 to :44)
#loc72 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:17 to :65)
#loc73 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":818:4 to :14)
#loc74 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":825:25 to :54)
#loc75 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":825:4 to :22)
#loc76 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":826:25 to :54)
#loc77 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":826:4 to :22)
#loc78 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":827:25 to :54)
#loc79 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":827:4 to :22)
#loc80 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":969:17 to 971:5)
#loc81 = loc("/home/ptoulme/miniconda3/envs/vllm/lib/python3.12/site-packages/jax/experimental/pallas/ops/tpu/splash_attention/splash_attention_kernel.py":977:17 to 979:5)
#loc82 = loc("flash_attention_kernel"(#loc1))
#loc83 = loc("_splash_attention_forward"(#loc2))
#loc84 = loc("_splash_attention_custom"(#loc3))
#loc85 = loc("_splash_attention"(#loc4))
#loc86 = loc("SplashAttentionKernel.__call__"(#loc5))
#loc87 = loc("benchmark_kernel.<locals>.splash_attention_kernel"(#loc6))
#loc88 = loc("benchmark_kernel"(#loc7))
#loc89 = loc("main"(#loc8))
#loc90 = loc("<module>"(#loc9))
#loc91 = loc("flash_attention_kernel"(#loc10))
#loc92 = loc("flash_attention_kernel.<locals>.init"(#loc11))
#loc93 = loc("flash_attention_kernel.<locals>.init"(#loc12))
#loc94 = loc("flash_attention_kernel.<locals>.init"(#loc13))
#loc95 = loc("flash_attention_kernel.<locals>.init"(#loc14))
#loc96 = loc("flash_attention_kernel.<locals>.init"(#loc15))
#loc97 = loc("flash_attention_kernel.<locals>.init"(#loc16))
#loc98 = loc("_next_nonzero"(#loc17))
#loc99 = loc("flash_attention_kernel"(#loc18))
#loc100 = loc("_next_nonzero.<locals>.<lambda>"(#loc19))
#loc101 = loc("_next_nonzero"(#loc20))
#loc102 = loc("_next_nonzero"(#loc21))
#loc103 = loc("_next_nonzero"(#loc22))
#loc104 = loc("_next_nonzero"(#loc23))
#loc105 = loc("flash_attention_kernel"(#loc24))
#loc106 = loc("flash_attention_kernel.<locals>.run"(#loc25))
#loc107 = loc("flash_attention_kernel.<locals>.body"(#loc26))
#loc108 = loc("flash_attention_kernel.<locals>.body"(#loc27))
#loc109 = loc("flash_attention_kernel.<locals>.body"(#loc28))
#loc110 = loc("flash_attention_kernel.<locals>.body"(#loc29))
#loc111 = loc("flash_attention_kernel.<locals>.body"(#loc30))
#loc112 = loc("flash_attention_kernel.<locals>.body"(#loc31))
#loc113 = loc("flash_attention_kernel.<locals>.body"(#loc32))
#loc114 = loc("flash_attention_kernel.<locals>.body"(#loc33))
#loc115 = loc("flash_attention_kernel.<locals>.body"(#loc34))
#loc116 = loc("_apply_mask_and_soft_cap"(#loc35))
#loc117 = loc("flash_attention_kernel.<locals>.body"(#loc36))
#loc118 = loc("_apply_mask_and_soft_cap"(#loc37))
#loc119 = loc("_apply_mask_and_soft_cap"(#loc38))
#loc120 = loc("_apply_mask_and_soft_cap"(#loc39))
#loc121 = loc("CausalMask.__init__.<locals>.causal_mask_function"(#loc40))
#loc122 = loc("_apply_mask_and_soft_cap"(#loc41))
#loc123 = loc("_apply_mask_and_soft_cap"(#loc42))
#loc124 = loc("flash_attention_kernel.<locals>.body"(#loc43))
#loc125 = loc("flash_attention_kernel.<locals>.body"(#loc44))
#loc126 = loc("flash_attention_kernel.<locals>.body"(#loc45))
#loc127 = loc("flash_attention_kernel.<locals>.body"(#loc46))
#loc128 = loc("flash_attention_kernel.<locals>.body"(#loc47))
#loc129 = loc("flash_attention_kernel.<locals>.body"(#loc48))
#loc130 = loc("flash_attention_kernel.<locals>.body"(#loc49))
#loc131 = loc("flash_attention_kernel.<locals>.body"(#loc50))
#loc132 = loc("flash_attention_kernel.<locals>.body"(#loc51))
#loc133 = loc("flash_attention_kernel.<locals>.body"(#loc52))
#loc134 = loc("flash_attention_kernel.<locals>.body"(#loc53))
#loc135 = loc("flash_attention_kernel.<locals>.body"(#loc54))
#loc136 = loc("flash_attention_kernel.<locals>.body"(#loc55))
#loc137 = loc("flash_attention_kernel.<locals>.body"(#loc56))
#loc138 = loc("flash_attention_kernel.<locals>.body"(#loc57))
#loc139 = loc("flash_attention_kernel.<locals>.body"(#loc58))
#loc140 = loc("flash_attention_kernel.<locals>.body"(#loc59))
#loc141 = loc("flash_attention_kernel.<locals>.body"(#loc60))
#loc142 = loc("flash_attention_kernel.<locals>.body"(#loc61))
#loc143 = loc("flash_attention_kernel.<locals>.body"(#loc62))
#loc144 = loc("flash_attention_kernel.<locals>.body"(#loc63))
#loc145 = loc("flash_attention_kernel.<locals>.body"(#loc64))
#loc146 = loc("flash_attention_kernel"(#loc65))
#loc147 = loc("flash_attention_kernel"(#loc66))
#loc148 = loc("flash_attention_kernel.<locals>.end"(#loc67))
#loc149 = loc("flash_attention_kernel.<locals>.end"(#loc68))
#loc150 = loc("flash_attention_kernel.<locals>.end"(#loc69))
#loc151 = loc("flash_attention_kernel.<locals>.end"(#loc70))
#loc152 = loc("flash_attention_kernel.<locals>.end"(#loc71))
#loc153 = loc("flash_attention_kernel.<locals>.end"(#loc72))
#loc154 = loc("flash_attention_kernel.<locals>.end"(#loc73))
#loc155 = loc("flash_attention_kernel.<locals>.end"(#loc74))
#loc156 = loc("flash_attention_kernel.<locals>.end"(#loc75))
#loc157 = loc("flash_attention_kernel.<locals>.end"(#loc76))
#loc158 = loc("flash_attention_kernel.<locals>.end"(#loc77))
#loc159 = loc("flash_attention_kernel.<locals>.end"(#loc78))
#loc160 = loc("flash_attention_kernel.<locals>.end"(#loc79))
#loc161 = loc("_splash_attention_forward.<locals>.k_index_map"(#loc80))
#loc162 = loc("_splash_attention_forward.<locals>.v_index_map"(#loc81))
#loc163 = loc(callsite(#loc89 at #loc90))
#loc164 = loc(callsite(#loc88 at #loc89))
#loc165 = loc(callsite(#loc87 at #loc88))
#loc166 = loc(callsite(#loc86 at #loc87))
#loc167 = loc(callsite(#loc88 at #loc163))
#loc168 = loc(callsite(#loc87 at #loc164))
#loc169 = loc(callsite(#loc86 at #loc165))
#loc170 = loc(callsite(#loc85 at #loc166))
#loc171 = loc(callsite(#loc87 at #loc167))
#loc172 = loc(callsite(#loc86 at #loc168))
#loc173 = loc(callsite(#loc85 at #loc169))
#loc174 = loc(callsite(#loc84 at #loc170))
#loc175 = loc(callsite(#loc86 at #loc171))
#loc176 = loc(callsite(#loc85 at #loc172))
#loc177 = loc(callsite(#loc84 at #loc173))
#loc178 = loc(callsite(#loc83 at #loc174))
#loc179 = loc(callsite(#loc85 at #loc175))
#loc180 = loc(callsite(#loc84 at #loc176))
#loc181 = loc(callsite(#loc83 at #loc177))
#loc182 = loc(callsite(#loc105 at #loc178))
#loc183 = loc(callsite(#loc84 at #loc179))
#loc184 = loc(callsite(#loc83 at #loc180))
#loc185 = loc(callsite(#loc105 at #loc181))
#loc186 = loc(callsite(#loc106 at #loc182))
#loc187 = loc(callsite(#loc83 at #loc183))
#loc188 = loc(callsite(#loc99 at #loc184))
#loc189 = loc(callsite(#loc105 at #loc184))
#loc190 = loc(callsite(#loc106 at #loc185))
#loc191 = loc(callsite(#loc117 at #loc186))
#loc192 = loc(callsite(#loc161 at #loc184))
#loc193 = loc(callsite(#loc162 at #loc184))
#loc194 = loc(callsite(#loc82 at #loc187))
#loc195 = loc(callsite(#loc91 at #loc187))
#loc196 = loc(callsite(#loc99 at #loc187))
#loc197 = loc(callsite(#loc101 at #loc188))
#loc198 = loc(callsite(#loc104 at #loc188))
#loc199 = loc(callsite(#loc105 at #loc187))
#loc200 = loc(callsite(#loc106 at #loc189))
#loc201 = loc(callsite(#loc117 at #loc190))
#loc202 = loc(callsite(#loc122 at #loc191))
#loc203 = loc(callsite(#loc146 at #loc187))
#loc204 = loc(callsite(#loc147 at #loc187))
#loc205 = loc(callsite(#loc161 at #loc187))
#loc206 = loc(callsite(#loc101 at #loc192))
#loc207 = loc(callsite(#loc104 at #loc192))
#loc208 = loc(callsite(#loc162 at #loc187))
#loc209 = loc(callsite(#loc101 at #loc193))
#loc210 = loc(callsite(#loc104 at #loc193))
#loc211 = loc("/eq"(#loc194))
#loc212 = loc("/convert_element_type"(#loc195))
#loc213 = loc("/cond"(#loc195))
#loc214 = loc(callsite(#loc92 at #loc195))
#loc215 = loc(callsite(#loc93 at #loc195))
#loc216 = loc(callsite(#loc94 at #loc195))
#loc217 = loc(callsite(#loc95 at #loc195))
#loc218 = loc(callsite(#loc96 at #loc195))
#loc219 = loc(callsite(#loc97 at #loc195))
#loc220 = loc(callsite(#loc98 at #loc196))
#loc221 = loc(callsite(#loc100 at #loc197))
#loc222 = loc(callsite(#loc102 at #loc196))
#loc223 = loc(callsite(#loc103 at #loc196))
#loc224 = loc(callsite(#loc100 at #loc198))
#loc225 = loc("/convert_element_type"(#loc199))
#loc226 = loc("/cond"(#loc199))
#loc227 = loc(callsite(#loc106 at #loc199))
#loc228 = loc(callsite(#loc107 at #loc200))
#loc229 = loc(callsite(#loc108 at #loc200))
#loc230 = loc(callsite(#loc109 at #loc200))
#loc231 = loc(callsite(#loc110 at #loc200))
#loc232 = loc(callsite(#loc111 at #loc200))
#loc233 = loc(callsite(#loc112 at #loc200))
#loc234 = loc(callsite(#loc113 at #loc200))
#loc235 = loc(callsite(#loc114 at #loc200))
#loc236 = loc(callsite(#loc115 at #loc200))
#loc237 = loc(callsite(#loc116 at #loc201))
#loc238 = loc(callsite(#loc118 at #loc201))
#loc239 = loc(callsite(#loc119 at #loc201))
#loc240 = loc(callsite(#loc120 at #loc201))
#loc241 = loc(callsite(#loc121 at #loc202))
#loc242 = loc(callsite(#loc123 at #loc201))
#loc243 = loc(callsite(#loc124 at #loc200))
#loc244 = loc(callsite(#loc125 at #loc200))
#loc245 = loc(callsite(#loc126 at #loc200))
#loc246 = loc(callsite(#loc127 at #loc200))
#loc247 = loc(callsite(#loc128 at #loc200))
#loc248 = loc(callsite(#loc129 at #loc200))
#loc249 = loc(callsite(#loc130 at #loc200))
#loc250 = loc(callsite(#loc131 at #loc200))
#loc251 = loc(callsite(#loc132 at #loc200))
#loc252 = loc(callsite(#loc133 at #loc200))
#loc253 = loc(callsite(#loc134 at #loc200))
#loc254 = loc(callsite(#loc135 at #loc200))
#loc255 = loc(callsite(#loc136 at #loc200))
#loc256 = loc(callsite(#loc137 at #loc200))
#loc257 = loc(callsite(#loc138 at #loc200))
#loc258 = loc(callsite(#loc139 at #loc200))
#loc259 = loc(callsite(#loc140 at #loc200))
#loc260 = loc(callsite(#loc141 at #loc200))
#loc261 = loc(callsite(#loc142 at #loc200))
#loc262 = loc(callsite(#loc143 at #loc200))
#loc263 = loc(callsite(#loc144 at #loc200))
#loc264 = loc(callsite(#loc145 at #loc200))
#loc265 = loc("/eq"(#loc203))
#loc266 = loc("/convert_element_type"(#loc204))
#loc267 = loc("/cond"(#loc204))
#loc268 = loc(callsite(#loc148 at #loc204))
#loc269 = loc(callsite(#loc149 at #loc204))
#loc270 = loc(callsite(#loc150 at #loc204))
#loc271 = loc(callsite(#loc151 at #loc204))
#loc272 = loc(callsite(#loc152 at #loc204))
#loc273 = loc(callsite(#loc153 at #loc204))
#loc274 = loc(callsite(#loc154 at #loc204))
#loc275 = loc(callsite(#loc155 at #loc204))
#loc276 = loc(callsite(#loc156 at #loc204))
#loc277 = loc(callsite(#loc157 at #loc204))
#loc278 = loc(callsite(#loc158 at #loc204))
#loc279 = loc(callsite(#loc159 at #loc204))
#loc280 = loc(callsite(#loc160 at #loc204))
#loc281 = loc(callsite(#loc98 at #loc205))
#loc282 = loc(callsite(#loc100 at #loc206))
#loc283 = loc(callsite(#loc102 at #loc205))
#loc284 = loc(callsite(#loc103 at #loc205))
#loc285 = loc(callsite(#loc100 at #loc207))
#loc286 = loc(callsite(#loc98 at #loc208))
#loc287 = loc(callsite(#loc100 at #loc209))
#loc288 = loc(callsite(#loc102 at #loc208))
#loc289 = loc(callsite(#loc103 at #loc208))
#loc290 = loc(callsite(#loc100 at #loc210))
#loc291 = loc("/broadcast_in_dim"(#loc214))
#loc292 = loc("/swap"(#loc215))
#loc293 = loc("/broadcast_in_dim"(#loc216))
#loc294 = loc("/swap"(#loc217))
#loc295 = loc("/broadcast_in_dim"(#loc218))
#loc296 = loc("/swap"(#loc219))
#loc297 = loc("/get"(#loc220))
#loc298 = loc("/convert_element_type"(#loc221))
#loc299 = loc("/gt"(#loc222))
#loc300 = loc("/get"(#loc223))
#loc301 = loc("/convert_element_type"(#loc224))
#loc302 = loc("/scan"(#loc227))
#loc303 = loc("/mul"(#loc228))
#loc304 = loc("/get"(#loc229))
#loc305 = loc("/get"(#loc230))
#loc306 = loc("/get"(#loc231))
#loc307 = loc("/get"(#loc232))
#loc308 = loc("/dot_general"(#loc233))
#loc309 = loc("/mul"(#loc234))
#loc310 = loc("/mul"(#loc235))
#loc311 = loc("/add"(#loc236))
#loc312 = loc("/iota"(#loc237))
#loc313 = loc("/add"(#loc238))
#loc314 = loc("/get"(#loc239))
#loc315 = loc("/repeat"(#loc240))
#loc316 = loc("/ge"(#loc241))
#loc317 = loc("/pjit"(#loc242))
#loc318 = loc("/broadcast_in_dim"(#loc242))
#loc319 = loc("/select_n"(#loc242))
#loc320 = loc("/reduce_max"(#loc243))
#loc321 = loc("/broadcast_in_dim"(#loc244))
#loc322 = loc("/max"(#loc245))
#loc323 = loc("/repeat"(#loc246))
#loc324 = loc("/sub"(#loc247))
#loc325 = loc("/exp"(#loc248))
#loc326 = loc("/reduce_sum"(#loc249))
#loc327 = loc("/broadcast_in_dim"(#loc250))
#loc328 = loc("/sub"(#loc251))
#loc329 = loc("/exp"(#loc252))
#loc330 = loc("/mul"(#loc253))
#loc331 = loc("/add"(#loc254))
#loc332 = loc("/swap"(#loc255))
#loc333 = loc("/swap"(#loc256))
#loc334 = loc("/get"(#loc257))
#loc335 = loc("/convert_element_type"(#loc258))
#loc336 = loc("/dot_general"(#loc259))
#loc337 = loc("/repeat"(#loc260))
#loc338 = loc("/get"(#loc261))
#loc339 = loc("/mul"(#loc262))
#loc340 = loc("/add"(#loc263))
#loc341 = loc("/swap"(#loc264))
#loc342 = loc("/get"(#loc268))
#loc343 = loc("/div"(#loc269))
#loc344 = loc("/repeat"(#loc270))
#loc345 = loc("/get"(#loc271))
#loc346 = loc("/mul"(#loc272))
#loc347 = loc("/convert_element_type"(#loc273))
#loc348 = loc("/swap"(#loc274))
#loc349 = loc("/broadcast_in_dim"(#loc275))
#loc350 = loc("/swap"(#loc276))
#loc351 = loc("/broadcast_in_dim"(#loc277))
#loc352 = loc("/swap"(#loc278))
#loc353 = loc("/broadcast_in_dim"(#loc279))
#loc354 = loc("/swap"(#loc280))
#loc355 = loc("/get"(#loc281))
#loc356 = loc("/convert_element_type"(#loc282))
#loc357 = loc("/gt"(#loc283))
#loc358 = loc("/get"(#loc284))
#loc359 = loc("/convert_element_type"(#loc285))
#loc360 = loc("/get"(#loc286))
#loc361 = loc("/convert_element_type"(#loc287))
#loc362 = loc("/gt"(#loc288))
#loc363 = loc("/get"(#loc289))
#loc364 = loc("/convert_element_type"(#loc290))
